<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>äº‘ä¸Šä¸€æœº ç™»å½•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      font-family: "Helvetica Neue", Arial, sans-serif;
      background: #f0f6fa url('bg.png') no-repeat center center;
      background-size: cover;
    }

    .header {
      text-align: center;
      padding: 20px 0 10px;
      position: relative;
    }

    .header img {
      width: 72px;
      height: 72px;
      object-fit: contain;
    }

    .header h1 {
      margin-top: 12px;
      font-size: 24px;
      color: #222;
    }

    .header p {
      margin-top: 6px;
      font-size: 16px;
      color: #555;
    }

    /* æ‰«ä¸€æ‰«æŒ‰é’® */
    #scan-btn {
      position: absolute;
      right: 20px;
      top: 20px;
      padding: 6px 12px;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background: #409eff;
      color: #fff;
      cursor: pointer;
    }

    #scan-btn:hover {
      background: #66b1ff;
    }

    .login-container {
      width: 360px;
      margin: 0 auto;
    }

    .login-box {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .login-form {
      padding: 20px 30px;
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    .form-group input {
      width: 100%;
      padding: 12px 40px 12px 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .form-group .icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 18px;
      color: #999;
    }

    .form-group input:focus {
      border-color: #409eff;
      outline: none;
    }

    .network-select {
      margin-bottom: 20px;
    }

    .network-select select {
      width: 100%;
      padding: 12px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
      appearance: none;
      background: url('data:image/svg+xml;charset=UTF-8,<svg fill="%23999" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>') no-repeat right 12px center;
      background-color: #fff;
      background-size: 16px;
    }

    .btn-login {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      color: #fff;
      background: #409eff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-login:hover {
      background: #66b1ff;
    }

    .login-footer {
      margin: 40px auto 0;
      width: 360px;
      text-align: center;
      font-size: 12px;
      color: rgba(0, 0, 0, 0.3);
    }

    /* äºŒç»´ç æ‰«æåŒºåŸŸ */
    #qr-reader {
      width: 100%;
      max-width: 360px;
      margin: 20px auto;
      display: none;
    }
  </style>
  <!-- å¼•å…¥ html5-qrcode åº“ -->
  <script src="./libs/html5-qrcode.min.js"></script>
  <!-- <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script> -->
</head>

<body>
  <div class="header">
    <img src="logo.png" alt="äº‘ä¸Šä¸€æœº Logo">
    <h1>äº‘ä¸Šä¸€æœº</h1>
    <p>é¢†å¯¼å¹²éƒ¨è€ƒæ ¸æµ‹è¯„ç³»ç»Ÿ</p>
    <button id="scan-btn">æ‰«ä¸€æ‰«</button>
  </div>

  <!-- äºŒç»´ç æ‰«æå™¨å®¹å™¨ -->
  <div id="qr-reader"></div>

  <div class="login-container">
    <div class="login-box">
      <form class="login-form" id="login-form" onsubmit="return validateLogin(event)">
        <div class="form-group">
          <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
          <span class="icon">ğŸ‘¤</span>
        </div>
        <div class="form-group">
          <input type="password" placeholder="è¯·è¾“å…¥å¯†ç " required>
          <span class="icon">ğŸ”’</span>
        </div>
        <div class="network-select">
          <select>
            <option value="external">å¤–ç½‘</option>
            <option value="internal">å†…ç½‘</option>
          </select>
        </div>
        <button type="submit" class="btn-login">ç™»å½•</button>
      </form>
    </div>
  </div>

  <div class="login-footer">
    ä¸­å›½å…µå™¨ Â· ä¸€æœºé›†å›¢
  </div>

  <script>
    const scanBtn = document.getElementById('scan-btn');
    const qrReader = document.getElementById('qr-reader');
    let html5QrCode;

    scanBtn.addEventListener('click', () => {
      scanBtn.style.display = 'none';
      qrReader.style.display = 'block';

      html5QrCode = new Html5Qrcode("qr-reader");
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrCodeMessage => {
          // è¯†åˆ«åˆ°äºŒç»´ç åçš„å›è°ƒ
          // æœŸæœ›æ ¼å¼ "account:0220023"
          // index.html çš„æ‰«ç æˆåŠŸå›è°ƒä¸­åŠ å…¥ï¼š
          const match = qrCodeMessage.match(/account\\s*:\\s*(\\d+)/i);
          if (match) {
            const account = match[1];
            const ticketType = 'A'; // å¯ä»¥ä»äºŒç»´ç ä¸­è§£æï¼Œæˆ–é»˜è®¤èµ‹å€¼
            location.href = `GuidePage.html?account=${account}&ticketType=${ticketType}`;
          }

          // åœæ­¢æ‰«æå¹¶éšè—æ‰«æå™¨
          html5QrCode.stop().then(() => {
            qrReader.style.display = 'none';
            scanBtn.style.display = 'inline-block';
          });
        },
        errorMessage => {
          // è¯†åˆ«å¤±è´¥æˆ–éäºŒç»´ç æ—¶çš„å›è°ƒï¼Œå¯å¿½ç•¥
        }
      ).catch(err => {
        console.error("å¯åŠ¨æ‘„åƒå¤´å¤±è´¥:", err);
        alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æƒé™è®¾ç½®ï¼");
        qrReader.style.display = 'none';
        scanBtn.style.display = 'inline-block'; // æ¢å¤æŒ‰é’®æ˜¾ç¤º
      });
    });


    function validateLogin(event) {
      event.preventDefault(); // é˜»æ­¢é»˜è®¤æäº¤
      const username = document.getElementById('username').value.trim();
      const password = document.querySelector('input[type="password"]').value.trim();

      if (!username || !password) {
        alert("è¯·è¾“å…¥è´¦å·å’Œå¯†ç ï¼");
        return false;
      }

      // POST åˆ°ä½ åç«¯éªŒè¯æ¥å£ï¼ˆå¿…é¡»æ˜¯ HTTPSï¼‰
      // fetch('/api/verify', {
      //   method: 'POST',
      //   headers: { 'Content-Type': 'application/json' },
      //   body: JSON.stringify({ account: username, password: password })
      // }).then(res => res.json()).then(res => {
      //   if (res.ok) {
      //     // ç™»å½•æˆåŠŸè·³è½¬è¯´æ˜é¡µ
      //     location.href = `GuidePage.html?account=${username}&ticketType=${res.ticketType}`;
      //   } else {
      //     alert("è´¦å·æˆ–å¯†ç é”™è¯¯ï¼");
      //   }
      // }).catch(() => {
      //   alert("æœåŠ¡å™¨å¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ï¼");
      // });
      console.log(`æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼Œè·³è½¬åˆ° GuidePage.html?account=${username}&ticketType=A`);
      location.href = `GuidePage.html?account=${username}&ticketType=A`;


      return false; // é˜»æ­¢è¡¨å•è‡ªåŠ¨æäº¤
    }

  </script>
</body>

</html>